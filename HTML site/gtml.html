<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clothing Shop</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:Arial, sans-serif; }
body { background:#f5f5f5; }

/* Header */
.header {
    background:linear-gradient(to bottom, #ee4d2d, #ff6b6b);
    padding:15px;
    position:sticky;
    top:0;
    z-index:100;
}
.header-content {
    max-width:1200px;
    margin:0 auto;
    display:flex;
    align-items:center;
    gap:20px;
}
.logo {
    color:white;
    font-size:24px;
    font-weight:bold;
    text-decoration:none;
}
.search-box {
    flex:1;
    display:flex;
    background:white;
    border-radius:4px;
    overflow:hidden;
    position:relative;
}
.search-box input {
    flex:1;
    padding:10px;
    border:none;
    outline:none;
}
.clear-search {
    position:absolute;
    right:80px;
    top:50%;
    transform:translateY(-50%);
    background:#ddd;
    border:none;
    width:20px;
    height:20px;
    border-radius:50%;
    cursor:pointer;
    display:none;
    align-items:center;
    justify-content:center;
    font-size:12px;
}
.clear-search.show { display:flex; }
.search-btn {
    background:#ee4d2d;
    color:white;
    border:none;
    padding:0 20px;
    cursor:pointer;
}
.header-icons {
    display:flex;
    gap:20px;
    color:white;
}
.icon-btn {
    color:white;
    text-decoration:none;
    display:flex;
    flex-direction:column;
    align-items:center;
    font-size:12px;
    cursor:pointer;
    position:relative;
}
.cart-badge {
    position:absolute;
    top:-5px;
    right:-5px;
    background:white;
    color:#ee4d2d;
    font-size:10px;
    font-weight:bold;
    width:18px;
    height:18px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
}

/* Flash Sale */
.flash-sale {
    background:white;
    margin:15px;
    border-radius:8px;
    overflow:hidden;
    box-shadow:0 2px 4px rgba(0,0,0,0.1);
}
.flash-header {
    background:linear-gradient(to right, #ee4d2d, #ff6b6b);
    color:white;
    padding:15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.flash-title {
    display:flex;
    align-items:center;
    gap:10px;
    font-size:20px;
    font-weight:bold;
}
.timer {
    display:flex;
    gap:5px;
    align-items:center;
    margin-left:15px;
}
.timer-box {
    background:white;
    color:#ee4d2d;
    padding:5px 10px;
    border-radius:4px;
    font-weight:bold;
    font-size:16px;
    min-width:35px;
    text-align:center;
}
.timer-label {
    font-size:12px;
    color:#ffd700;
    margin-left:5px;
}

/* Products */
.container {
    max-width:1200px;
    margin:0 auto;
    padding:15px;
}
.section-title {
    font-size:18px;
    margin-bottom:15px;
    color:#333;
    display:flex;
    align-items:center;
    gap:10px;
}
.products-grid {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
    gap:15px;
}
.product-card {
    background:white;
    border-radius:8px;
    overflow:hidden;
    cursor:pointer;
    transition:transform 0.2s;
    border:1px solid #e8e8e8;
    position:relative;
}
.product-card:hover {
    transform:translateY(-5px);
    box-shadow:0 4px 12px rgba(0,0,0,0.15);
}
.sale-badge {
    position:absolute;
    top:10px;
    left:10px;
    background:#ee4d2d;
    color:white;
    padding:5px 10px;
    border-radius:4px;
    font-size:12px;
    font-weight:bold;
    z-index:10;
}
.discount-badge {
    position:absolute;
    top:10px;
    right:10px;
    background:#ffd700;
    color:#333;
    padding:5px 8px;
    border-radius:4px;
    font-size:11px;
    font-weight:bold;
    z-index:10;
}
.product-img {
    width:100%;
    height:250px;
    object-fit:cover;
}
.product-info { padding:12px; }
.product-name {
    font-size:14px;
    height:40px;
    overflow:hidden;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
}
.price-row {
    display:flex;
    align-items:center;
    gap:8px;
    margin:8px 0;
}
.current-price {
    color:#ee4d2d;
    font-size:18px;
    font-weight:bold;
}
.original-price {
    color:#999;
    font-size:12px;
    text-decoration:line-through;
}
.sold-count {
    color:#999;
    font-size:12px;
}
.add-btn {
    width:100%;
    padding:8px;
    background:#ee4d2d;
    color:white;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-size:14px;
    margin-top:8px;
}
.add-btn:hover { background:#d73211; }

/* Search Results */
.search-results {
    display:none;
    padding:15px;
}
.search-results.active { display:block; }
.search-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
    padding-bottom:15px;
    border-bottom:2px solid #ee4d2d;
}
.back-home {
    background:#ee4d2d;
    color:white;
    border:none;
    padding:8px 15px;
    border-radius:4px;
    cursor:pointer;
}

/* Cart */
.cart-overlay {
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:999;
}
.cart-overlay.active { display:block; }
.cart-sidebar {
    position:fixed;
    top:0;
    right:-400px;
    width:400px;
    height:100%;
    background:white;
    z-index:1000;
    transition:right 0.3s;
    display:flex;
    flex-direction:column;
}
.cart-sidebar.active { right:0; }
.cart-header {
    padding:20px;
    border-bottom:1px solid #eee;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.close-btn {
    background:none;
    border:none;
    font-size:24px;
    cursor:pointer;
}
.cart-items {
    flex:1;
    overflow-y:auto;
    padding:20px;
}
.empty-cart {
    text-align:center;
    color:#999;
    padding:40px;
}
.cart-item {
    display:flex;
    gap:15px;
    margin-bottom:15px;
    padding-bottom:15px;
    border-bottom:1px solid #eee;
}
.cart-item img {
    width:80px;
    height:80px;
    object-fit:cover;
    border-radius:4px;
}
.remove-btn {
    color:#ee4d2d;
    cursor:pointer;
    font-size:12px;
    background:none;
    border:none;
}
.cart-footer {
    padding:20px;
    border-top:1px solid #eee;
}
.cart-total {
    display:flex;
    justify-content:space-between;
    font-size:18px;
    font-weight:bold;
    margin-bottom:15px;
}
.checkout-btn {
    width:100%;
    padding:15px;
    background:#ee4d2d;
    color:white;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-size:16px;
}

/* Checkout Form */
.checkout-form {
    display:none;
    padding:20px;
    background:#f9f9f9;
    border-top:2px solid #ee4d2d;
    overflow-y:auto;
    max-height:70vh;
}
.checkout-form.active { display:block; }
.form-group {
    margin-bottom:15px;
}
.form-group label {
    display:block;
    margin-bottom:5px;
    font-size:14px;
    font-weight:bold;
}
.form-group input, .form-group select, .form-group textarea {
    width:100%;
    padding:10px;
    border:1px solid #ddd;
    border-radius:4px;
    font-size:14px;
}
.form-row {
    display:flex;
    gap:10px;
}
.form-row .form-group {
    flex:1;
}
.payment-methods {
    display:flex;
    flex-direction:column;
    gap:10px;
}
.payment-method {
    display:flex;
    align-items:center;
    gap:10px;
    padding:10px;
    border:1px solid #ddd;
    border-radius:4px;
    cursor:pointer;
}
.payment-method:hover { border-color:#ee4d2d; }
.payment-method input { width:auto; }
.place-order-btn {
    width:100%;
    padding:15px;
    background:#2ecc71;
    color:white;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-size:16px;
    font-weight:bold;
    margin-top:15px;
}
.back-btn {
    width:100%;
    padding:10px;
    background:#999;
    color:white;
    border:none;
    border-radius:4px;
    cursor:pointer;
    margin-top:10px;
}

/* Auth Modal */
.modal {
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:1001;
    justify-content:center;
    align-items:center;
    overflow-y:auto;
}
.modal.active { display:flex; }
.modal-content {
    background:white;
    padding:30px;
    border-radius:8px;
    width:90%;
    max-width:450px;
    max-height:90vh;
    overflow-y:auto;
    margin:20px 0;
}
.modal-title {
    font-size:24px;
    margin-bottom:20px;
    text-align:center;
}
.form-group input {
    width:100%;
    padding:12px;
    margin-bottom:12px;
    border:1px solid #ddd;
    border-radius:4px;
    font-size:14px;
}
.form-group small {
    color:#666;
    font-size:12px;
}
.submit-btn {
    width:100%;
    padding:12px;
    background:#ee4d2d;
    color:white;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-size:16px;
    font-weight:bold;
    margin-top:10px;
}
.switch-text {
    text-align:center;
    margin-top:15px;
    font-size:14px;
}
.switch-text a {
    color:#ee4d2d;
    cursor:pointer;
    font-weight:bold;
}
.divider {
    text-align:center;
    margin:15px 0;
    color:#999;
    font-size:12px;
    position:relative;
}
.divider::before, .divider::after {
    content:'';
    position:absolute;
    top:50%;
    width:40%;
    height:1px;
    background:#ddd;
}
.divider::before { left:0; }
.divider::after { right:0; }

/* Toast */
.toast {
    position:fixed;
    bottom:100px;
    left:50%;
    transform:translateX(-50%) translateY(100px);
    background:#333;
    color:white;
    padding:12px 24px;
    border-radius:4px;
    opacity:0;
    transition:all 0.3s;
    z-index:2000;
}
.toast.show {
    opacity:1;
    transform:translateX(-50%) translateY(0);
}

.no-results {
    text-align:center;
    padding:40px;
    color:#999;
}
.no-results button {
    margin-top:15px;
    padding:10px 20px;
    background:#ee4d2d;
    color:white;
    border:none;
    border-radius:4px;
    cursor:pointer;
}
</style>
</head>

<body>

<!-- Header -->
<header class="header">
    <div class="header-content">
        <a href="#" class="logo">üëï Clothing Shop</a>
        <div class="search-box">
            <input type="text" placeholder="Search clothes..." id="searchInput" oninput="handleSearch(this.value)">
            <button class="clear-search" id="clearSearch" onclick="clearSearch()">√ó</button>
            <button class="search-btn" onclick="searchProducts()">Search</button>
        </div>
        <div class="header-icons">
            <div class="icon-btn" onclick="toggleCart()">
                üõí Cart
                <span class="cart-badge" id="cartCount">0</span>
            </div>
            <div class="icon-btn" onclick="openModal('loginModal')">
                üë§ Login
            </div>
        </div>
    </div>
</header>

<!-- HOME PAGE -->
<div id="homePage">
    <!-- Flash Sale -->
    <div class="flash-sale">
        <div class="flash-header">
            <div class="flash-title">
                <span>‚ö°</span>
                Flash Sale
                <div class="timer">
                    <span class="timer-box" id="hours">00</span>
                    <span>:</span>
                    <span class="timer-box" id="minutes">00</span>
                    <span>:</span>
                    <span class="timer-box" id="seconds">00</span>
                </div>
                <span class="timer-label">LEFT</span>
            </div>
            <a href="#" style="color:white; text-decoration:none; font-size:14px;">View All ></a>
        </div>
        <div class="container">
            <div class="products-grid" id="flashGrid"></div>
        </div>
    </div>

    <!-- Regular Products -->
    <div class="container">
        <h2 class="section-title">üëó For You</h2>
        <div class="products-grid" id="productsGrid"></div>
    </div>
</div>

<!-- SEARCH RESULTS -->
<div class="search-results" id="searchResults">
    <div class="container">
        <div class="search-header">
            <h2>Search Results: "<span id="searchQuery"></span>"</h2>
            <button class="back-home" onclick="clearSearch()">‚Üê Back to Home</button>
        </div>
        <div class="products-grid" id="searchGrid"></div>
        <div class="no-results" id="noResults" style="display:none;">
            <h3>No products found</h3>
            <p>Try different keywords</p>
            <button onclick="clearSearch()">Back to Home</button>
        </div>
    </div>
</div>

<!-- Cart Sidebar -->
<div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
<div class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
        <h3>Shopping Cart (<span id="cartItemCount">0</span>)</h3>
        <button class="close-btn" onclick="toggleCart()">&times;</button>
    </div>
    
    <div class="cart-items" id="cartItems">
        <div class="empty-cart">Your cart is empty</div>
    </div>
    
    <div class="cart-footer" id="cartFooter">
        <div class="cart-total">
            <span>Total:</span>
            <span id="cartTotal">‚Ç±0</span>
        </div>
        <button class="checkout-btn" onclick="showCheckout()">Proceed to Checkout</button>
    </div>
    
    <!-- Checkout Form -->
    <div class="checkout-form" id="checkoutForm">
        <h3 style="margin-bottom:15px;">Delivery Information</h3>
        
        <div class="form-group">
            <label>Full Name *</label>
            <input type="text" id="checkoutName" placeholder="Juan Dela Cruz">
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Phone Number *</label>
                <input type="tel" id="checkoutPhone" placeholder="09123456789">
            </div>
            <div class="form-group">
                <label>Email *</label>
                <input type="email" id="checkoutEmail" placeholder="juan@email.com">
            </div>
        </div>
        
        <div class="form-group">
            <label>Complete Address *</label>
            <textarea id="checkoutAddress" rows="2" placeholder="Street, Barangay, City"></textarea>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>City *</label>
                <input type="text" id="checkoutCity" placeholder="Manila">
            </div>
            <div class="form-group">
                <label>Postal Code *</label>
                <input type="text" id="checkoutZip" placeholder="1000">
            </div>
        </div>
        
        <h3 style="margin:20px 0 15px;">Payment Method</h3>
        <div class="payment-methods">
            <label class="payment-method">
                <input type="radio" name="payment" value="cod" checked>
                <span>üíµ Cash on Delivery (COD)</span>
            </label>
            <label class="payment-method">
                <input type="radio" name="payment" value="gcash">
                <span>üì± GCash</span>
            </label>
            <label class="payment-method">
                <input type="radio" name="payment" value="card">
                <span>üí≥ Credit/Debit Card</span>
            </label>
        </div>
        
        <div id="cardDetails" style="display:none; margin-top:15px;">
            <div class="form-group">
                <label>Card Number</label>
                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Expiry Date</label>
                    <input type="text" id="cardExpiry" placeholder="MM/YY">
                </div>
                <div class="form-group">
                    <label>CVV</label>
                    <input type="text" id="cardCvv" placeholder="123">
                </div>
            </div>
            <div class="form-group">
                <label>Cardholder Name</label>
                <input type="text" id="cardName" placeholder="Name on card">
            </div>
        </div>
        
        <button class="place-order-btn" onclick="placeOrder()">Place Order</button>
        <button class="back-btn" onclick="hideCheckout()">Back to Cart</button>
    </div>
</div>

<!-- LOGIN MODAL -->
<div class="modal" id="loginModal">
    <div class="modal-content">
        <h2 class="modal-title">Welcome Back!</h2>
        <form onsubmit="handleLogin(event)">
            <div class="form-group">
                <input type="email" id="loginEmail" placeholder="Email Address" required>
            </div>
            <div class="form-group">
                <input type="password" id="loginPassword" placeholder="Password" required>
            </div>
            <button type="submit" class="submit-btn">LOGIN</button>
        </form>
        <div class="divider">OR</div>
        <div class="switch-text">
            New customer? <a onclick="switchModal('loginModal', 'signupModal')">Create Account</a>
        </div>
    </div>
</div>

<!-- SIGNUP MODAL - Add more fields here -->
<div class="modal" id="signupModal">
    <div class="modal-content">
        <h2 class="modal-title">Create Account</h2>
        <form onsubmit="handleSignup(event)">
            <!-- Personal Info -->
            <div class="form-group">
                <input type="text" id="signupFirstName" placeholder="First Name *" required>
            </div>
            <div class="form-group">
                <input type="text" id="signupLastName" placeholder="Last Name *" required>
            </div>
            
            <!-- Contact -->
            <div class="form-group">
                <input type="email" id="signupEmail" placeholder="Email Address *" required>
            </div>
            <div class="form-group">
                <input type="tel" id="signupPhone" placeholder="Phone Number *" required>
            </div>
            
            <!-- Security -->
            <div class="form-group">
                <input type="password" id="signupPassword" placeholder="Password *" required minlength="6">
                <small>Minimum 6 characters</small>
            </div>
            <div class="form-group">
                <input type="password" id="signupConfirmPassword" placeholder="Confirm Password *" required>
            </div>
            
            <!-- Address (Optional for signup, required for checkout) -->
            <div class="form-group">
                <input type="text" id="signupAddress" placeholder="Address (Optional)">
            </div>
            <div class="form-group">
                <input type="text" id="signupCity" placeholder="City (Optional)">
            </div>
            
            <!-- Birthday (Optional) -->
            <div class="form-row">
                <div class="form-group">
                    <input type="date" id="signupBirthday" placeholder="Birthday (Optional)">
                </div>
                <div class="form-group">
                    <select id="signupGender" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:4px;">
                        <option value="">Gender (Optional)</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            
            <!-- Terms -->
            <div class="form-group" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="signupTerms" required style="width:auto;">
                <label for="signupTerms" style="margin:0; font-weight:normal; font-size:13px;">
                    I agree to the Terms and Conditions *
                </label>
            </div>
            
            <button type="submit" class="submit-btn">CREATE ACCOUNT</button>
        </form>
        <div class="switch-text">
            Already have an account? <a onclick="switchModal('signupModal', 'loginModal')">Login</a>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
// Products Data
const flashSaleProducts = [
    { id:101, name:"Oversized Street Tee", price:499, original:799, image:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400", sold:"1.2k", discount:"37%" },
    { id:102, name:"Korean Style Hoodie", price:999, original:1499, image:"https://images.unsplash.com/photo-1554568218-0f1715e72254?w=400", sold:"856", discount:"33%" },
    { id:103, name:"Y2K Cargo Pants", price:899, original:1299, image:"https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=400", sold:"2.3k", discount:"31%" },
    { id:104, name:"Denim Jacket", price:1399, original:1899, image:"https://images.unsplash.com/photo-1520975916090-3105956dac38?w=400", sold:"567", discount:"26%" },
    { id:105, name:"Bomber Jacket", price:1699, original:2199, image:"https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=400", sold:"432", discount:"23%" },
    { id:106, name:"Summer Floral Dress", price:799, original:1099, image:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=400", sold:"2.1k", discount:"27%" }
];

const regularProducts = [
    { id:1, name:"Minimalist White Shirt", price:699, image:"https://images.unsplash.com/photo-1503341504253-dff4815485f1?w=400", sold:"3.1k" },
    { id:2, name:"Graphic Print Tee", price:899, image:"https://images.unsplash.com/photo-1523381210434-271e8be1f52b?w=400", sold:"945" },
    { id:3, name:"Classic Black Jeans", price:1199, image:"https://images.unsplash.com/photo-1473966968600-fa801b869a1a?w=400", sold:"1.8k" },
    { id:4, name:"Elegant Black Dress", price:1499, image:"https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=400", sold:"1.5k" },
    { id:5, name:"Streetwear Cap", price:499, image:"https://images.unsplash.com/photo-1512436991641-6745cdb1723f?w=400", sold:"4.2k" },
    { id:6, name:"Trendy Shoulder Bag", price:899, image:"https://images.unsplash.com/photo-1520974735194-1d3a9c7f63b5?w=400", sold:"892" }
];

let cart = [];
let currentUser = null;
let flashSaleEndTime = null;
let searchTimeout;

// Initialize
window.onload = function() {
    renderFlashSale();
    renderRegularProducts();
    loadUser();
    initFlashSaleTimer();
    
    // Payment method toggle
    document.querySelectorAll('input[name="payment"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.getElementById('cardDetails').style.display = 
                this.value === 'card' ? 'block' : 'none';
        });
    });
};

// ACCURATE Flash Sale Timer (24 hours from now)
function initFlashSaleTimer() {
    // Check if we have a saved end time
    const savedEndTime = localStorage.getItem('flashSaleEndTime');
    
    if (savedEndTime) {
        flashSaleEndTime = parseInt(savedEndTime);
        // If expired, set new 24 hours
        if (flashSaleEndTime < Date.now()) {
            flashSaleEndTime = Date.now() + (24 * 60 * 60 * 1000);
            localStorage.setItem('flashSaleEndTime', flashSaleEndTime);
        }
    } else {
        // First time - set 24 hours from now
        flashSaleEndTime = Date.now() + (24 * 60 * 60 * 1000);
        localStorage.setItem('flashSaleEndTime', flashSaleEndTime);
    }
    
    updateTimer();
    setInterval(updateTimer, 1000);
}

function updateTimer() {
    const now = Date.now();
    let diff = flashSaleEndTime - now;
    
    if (diff <= 0) {
        // Reset to new 24 hours
        flashSaleEndTime = Date.now() + (24 * 60 * 60 * 1000);
        localStorage.setItem('flashSaleEndTime', flashSaleEndTime);
        diff = 24 * 60 * 60 * 1000;
    }
    
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
    
    document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
    document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
}

// Render Products
function renderFlashSale() {
    const grid = document.getElementById('flashGrid');
    grid.innerHTML = flashSaleProducts.map(p => `
        <div class="product-card">
            <span class="sale-badge">FLASH SALE</span>
            <span class="discount-badge">-${p.discount}</span>
            <img src="${p.image}" class="product-img">
            <div class="product-info">
                <div class="product-name">${p.name}</div>
                <div class="price-row">
                    <span class="current-price">‚Ç±${p.price}</span>
                    <span class="original-price">‚Ç±${p.original}</span>
                </div>
                <div class="sold-count">${p.sold} sold</div>
                <button class="add-btn" onclick="addToCart(${p.id}, true)">Add to Cart</button>
            </div>
        </div>
    `).join('');
}

function renderRegularProducts() {
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = regularProducts.map(p => `
        <div class="product-card">
            <img src="${p.image}" class="product-img">
            <div class="product-info">
                <div class="product-name">${p.name}</div>
                <div class="price-row">
                    <span class="current-price">‚Ç±${p.price}</span>
                </div>
                <div class="sold-count">${p.sold} sold</div>
                <button class="add-btn" onclick="addToCart(${p.id}, false)">Add to Cart</button>
            </div>
        </div>
    `).join('');
}

// Search Functions
function handleSearch(value) {
    const clearBtn = document.getElementById('clearSearch');
    
    if (value.length > 0) {
        clearBtn.classList.add('show');
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            if (value.length >= 2) {
                performSearch(value);
            }
        }, 500);
    } else {
        clearBtn.classList.remove('show');
        clearSearch();
    }
}

function searchProducts() {
    const query = document.getElementById('searchInput').value;
    if (query.length >= 2) {
        performSearch(query);
    }
}

function performSearch(query) {
    const allProducts = [...flashSaleProducts, ...regularProducts];
    const results = allProducts.filter(p => 
        p.name.toLowerCase().includes(query.toLowerCase())
    );
    
    document.getElementById('homePage').style.display = 'none';
    document.getElementById('searchResults').classList.add('active');
    document.getElementById('searchQuery').textContent = query;
    
    const grid = document.getElementById('searchGrid');
    const noResults = document.getElementById('noResults');
    
    if (results.length === 0) {
        grid.innerHTML = '';
        noResults.style.display = 'block';
    } else {
        noResults.style.display = 'none';
        grid.innerHTML = results.map(p => {
            const isFlash = flashSaleProducts.find(f => f.id === p.id);
            return `
                <div class="product-card">
                    ${isFlash ? `<span class="sale-badge">FLASH SALE</span><span class="discount-badge">-${p.discount}</span>` : ''}
                    <img src="${p.image}" class="product-img">
                    <div class="product-info">
                        <div class="product-name">${p.name}</div>
                        <div class="price-row">
                            <span class="current-price">‚Ç±${p.price}</span>
                            ${p.original ? `<span class="original-price">‚Ç±${p.original}</span>` : ''}
                        </div>
                        <div class="sold-count">${p.sold} sold</div>
                        <button class="add-btn" onclick="addToCart(${p.id}, ${isFlash ? 'true' : 'false'})">Add to Cart</button>
                    </div>
                </div>
            `;
        }).join('');
    }
}

function clearSearch() {
    document.getElementById('searchInput').value = '';
    document.getElementById('clearSearch').classList.remove('show');
    document.getElementById('homePage').style.display = 'block';
    document.getElementById('searchResults').classList.remove('active');
}

// Cart Functions
function addToCart(id, isFlash) {
    const source = isFlash ? flashSaleProducts : regularProducts;
    const product = source.find(p => p.id === id);
    const existing = cart.find(item => item.id === id);
    
    if (existing) {
        existing.quantity++;
    } else {
        cart.push({...product, quantity:1});
    }
    updateCart();
    showToast('Added to cart!');
}

function removeFromCart(id) {
    cart = cart.filter(item => item.id !== id);
    updateCart();
}

function updateCart() {
    const count = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cartCount').textContent = count;
    document.getElementById('cartItemCount').textContent = count;
    
    const itemsDiv = document.getElementById('cartItems');
    if (cart.length === 0) {
        itemsDiv.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
    } else {
        itemsDiv.innerHTML = cart.map(item => `
            <div class="cart-item">
                <img src="${item.image}">
                <div style="flex:1;">
                    <div>${item.name}</div>
                    <div style="color:#ee4d2d; font-weight:bold;">‚Ç±${item.price} x ${item.quantity}</div>
                    <button class="remove-btn" onclick="removeFromCart(${item.id})">Remove</button>
                </div>
            </div>
        `).join('');
    }
    
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    document.getElementById('cartTotal').textContent = '‚Ç±' + total.toLocaleString();
}

function toggleCart() {
    document.getElementById('cartSidebar').classList.toggle('active');
    document.getElementById('cartOverlay').classList.toggle('active');
    hideCheckout();
}

// Checkout
function showCheckout() {
    if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
    }
    document.getElementById('cartFooter').style.display = 'none';
    document.getElementById('checkoutForm').classList.add('active');
}

function hideCheckout() {
    document.getElementById('cartFooter').style.display = 'block';
    document.getElementById('checkoutForm').classList.remove('active');
}

function placeOrder() {
    const name = document.getElementById('checkoutName').value;
    const phone = document.getElementById('checkoutPhone').value;
    const email = document.getElementById('checkoutEmail').value;
    const address = document.getElementById('checkoutAddress').value;
    const city = document.getElementById('checkoutCity').value;
    const zip = document.getElementById('checkoutZip').value;
    const payment = document.querySelector('input[name="payment"]:checked').value;
    
    if (!name || !phone || !email || !address || !city || !zip) {
        alert('Please fill in all required fields!');
        return;
    }
    
    if (payment === 'card') {
        const cardNum = document.getElementById('cardNumber').value;
        const expiry = document.getElementById('cardExpiry').value;
        const cvv = document.getElementById('cardCvv').value;
        const cardName = document.getElementById('cardName').value;
        if (!cardNum || !expiry || !cvv || !cardName) {
            alert('Please fill in all card details!');
            return;
        }
    }
    
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const paymentText = payment === 'cod' ? 'Cash on Delivery' : 
                       payment === 'gcash' ? 'GCash' : 'Credit/Debit Card';
    
    alert(`‚úÖ Order Placed Successfully!\n\n` +
          `üë§ ${name}\n` +
          `üì± ${phone}\n` +
          `üìß ${email}\n` +
          `üè† ${address}, ${city} ${zip}\n` +
          `üí≥ ${paymentText}\n` +
          `üí∞ Total: ‚Ç±${total.toLocaleString()}\n\n` +
          `Thank you for shopping!`);
    
    cart = [];
    updateCart();
    toggleCart();
    hideCheckout();
    
    // Clear form
    ['checkoutName','checkoutPhone','checkoutEmail','checkoutAddress','checkoutCity','checkoutZip'].forEach(id => {
        document.getElementById(id).value = '';
    });
}

// Auth Functions
function openModal(id) {
    document.getElementById(id).classList.add('active');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

function switchModal(closeId, openId) {
    closeModal(closeId);
    openModal(openId);
}

function handleSignup(e) {
    e.preventDefault();
    
    // Get all values
    const firstName = document.getElementById('signupFirstName').value;
    const lastName = document.getElementById('signupLastName').value;
    const email = document.getElementById('signupEmail').value;
    const phone = document.getElementById('signupPhone').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('signupConfirmPassword').value;
    const address = document.getElementById('signupAddress').value;
    const city = document.getElementById('signupCity').value;
    const birthday = document.getElementById('signupBirthday').value;
    const gender = document.getElementById('signupGender').value;
    
    // Validation
    if (password !== confirmPassword) {
        alert('Passwords do not match!');
        return;
    }
    
    if (password.length < 6) {
        alert('Password must be at least 6 characters!');
        return;
    }
    
    // Check existing
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    if (users.find(u => u.email === email)) {
        alert('Email already registered!');
        return;
    }
    
    // Save user with all info
    const userData = {
        firstName,
        lastName,
        fullName: firstName + ' ' + lastName,
        email,
        phone,
        password,
        address,
        city,
        birthday,
        gender,
        createdAt: new Date().toISOString()
    };
    
    users.push(userData);
    localStorage.setItem('users', JSON.stringify(users));
    
    // Auto login
    currentUser = { name: userData.fullName, email: userData.email };
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    updateAuthUI();
    closeModal('signupModal');
    showToast('Account created successfully!');
    
    // Clear form
    e.target.reset();
}

function handleLogin(e) {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const user = users.find(u => u.email === email && u.password === password);
    
    if (user) {
        currentUser = { name: user.fullName, email: user.email };
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        updateAuthUI();
        closeModal('loginModal');
        showToast('Welcome back, ' + user.firstName + '!');
    } else {
        alert('Invalid email or password!');
    }
}

function loadUser() {
    const saved = localStorage.getItem('currentUser');
    if (saved) {
        currentUser = JSON.parse(saved);
        updateAuthUI();
    }
}

function updateAuthUI() {
    if (currentUser) {
        document.querySelector('.header-icons').innerHTML = `
            <div class="icon-btn" onclick="toggleCart()">
                üõí Cart
                <span class="cart-badge" id="cartCount">${cart.reduce((sum,item) => sum + item.quantity, 0)}</span>
            </div>
            <div class="icon-btn" onclick="logout()">
                üë§ ${currentUser.name.split(' ')[0]}<br>
                <small>Logout</small>
            </div>
        `;
        updateCart();
    }
}

function logout() {
    currentUser = null;
    localStorage.removeItem('currentUser');
    location.reload();
}

function showToast(msg) {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 2000);
}

// Close modals on outside click
window.onclick = function(e) {
    if (e.target.classList.contains('modal')) {
        e.target.classList.remove('active');
    }
}
</script>

</body>
</html>